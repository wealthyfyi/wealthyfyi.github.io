let kudos = {
	icon : `<svg class="card__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="#27AB83">
  <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
</svg>`,
	budget: {
		subtitle : "Start building wealth",
		brief : "Having money left over each month is the first step towards becoming wealthy. Keep up the excellent work!"
	},
	efundKudo : {
		subtitle: "Prepared for emergencies",
		brief: "Emergencies can happen at any time. Fortunately, you're ready for them. Great job!"
	},
	employerMatchKudo : {
		subtitle: "Unbeatable returns",
		brief: "Employer contribution matching is a guaranteed return on your investment. The employer match is tax-free. Talk about a win-win! Getting the entire match accelerates wealth building."
	},
	debtFreeKudo : {
		subtitle: "Debt-free living",
		brief: "For many people, debt is a huge burden to shoulder. Being debt-free is a great situation to be in. Congratulations!"
	},
	hsaMaxKudo : {
		subtitle: "A healthy future ahead of you",
		brief: "Healthcare is expensive, and it increases with age. Fortunately, you're preparing for it by fully funding your Health Savings Account (HSA). Did you know an HSA is the best retirement account in America? There are no taxes on: <ul><li>the income that funds it,</li><li>the growth in the HSA, or </li><li>the withdrawals for eligible health expenses. </li>Pay out-of-pocket now if you can afford to. It'll pay off dramatically over time. Bonus tip: save all of your medical receipts and reimburse them with your HSA at any time in the future."
	},
	maxTraditionalIraKudo : {
		subtitle: "Savings now & later",
		brief: "Using a Traditional IRA account to invest will help your finances in the future and lower your tax bill this year. That's what we call a win-win!"
	},
	maxRothIraKudo : {
		subtitle: "Delayed gratification",
		brief: "Using a Roth IRA to invest means you are getting your taxes out of the way now. That money won't be taxed when you retire, no matter how much it grows."
	}
}
let recommendations = {
	icon : `<svg class="card__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="#FFEB3B">
  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
</svg>`,
	unsupported : {
		subtitle: "Check back later",
		brief: "Unfortunately we don't have support for your financial situation right now. Come back soon to check if we've added support, or when your situation changes."
	},
	spendLess : {
		subtitle: "Reduce your spending",
		brief: "To build wealth, you need to spend less than you make. The easiest way to start doing that is to reduce your spending."
	},
	efund1 : {
		subtitle: "Build an emergency fund",
		brief: "Being prepared for emergencies is a crucial step towards financial freedom. Get started by saving enough cash to cover a month of expenses in a high-yield savings account."
	},
	employerMatch : {
		subtitle: "Get unbeatable returns",
		brief: "Employer 401(K) contribution matches are a guaranteed return on your investment. Adjusted for risk, it's the best investment you can make. As a bonus, both your contribution and the employer match are tax-advantaged."
	},
	highInterest : {
		subtitle: "Pay down high-interest loans",
		brief: "\"High-interest\" debt is debt that is above the average rate-of-return for the stock market over time, which is about 7% adjusted for inflation. Investments have risk, whereas paying off high-interest debt does not."
	},
	avalancheMethod : {
		subtitle: "Efficiently escape debt",
		brief: "Make the minimum payments on all of your debts, then use any remaining money to pay off the debt with the highest interest rate. This method of paying off debt will save you the most money in interest payments."
	},
	increaseEfund1 : {
		subtitle:"Increase your emergency fund",
		brief: "You should already have $1000 set aside for small surprises. An emergency fund should cover 3-6 months of living expenses, e.g., housing, food, healthcare, transportation, and debt payments. Emergency funds do not cover unnecessary costs like entertainment, dining out, vacations, and secondary savings goals. An emergency fund reduces stress, prevents impulse spending, and safeguards you from poor financial decisions."
	},
	increaseEfund2 : {
		subtitle: "Increase your emergency fund",
		brief: "You should already have $1000 set aside for small surprises. An emergency fund should typically cover 3-6 months of living expenses. However, some situations call for more. Consider increasing your safety net to 6-12 months of expenses if you have unsteady income, low employment security, you're experiencing a recession, or are already retired. Emergency funds do not cover unnecessary costs like entertainment, dining out, vacations, and secondary savings goals. An emergency fund reduces stress, prevents impulse spending, and safeguards you from financial decisions."
	},
	reduceInterestRate : {
		subtitle: "Reduce your interest rates",
		brief: "Interest rates cause your debt to grow, making it more difficult to escape debt.  Reducing your interest rate will save you money over time. Strategies available for lowering interest rates depend on the type of debt that you have."
	},
	hsaFees : {
		subtitle: "Give your HSA a health check",
		brief: "While the Health Savings Account (HSA) is the best investment account in America, not all are created equal. Check if switching to another HSA provider could lower your fees."
	},
	hsaMax : {
		subtitle: "Invest in your future health",
		brief: "The Health Savings Account (HSA) is the best investing account America. Once you've maxed out your employer matching in your 401(K) account, the next best thing to max out is your HSA. It provides all the tax advantages of both a Traditional and a Roth retirement account, making it a better way to invest than both of them."
	},
	evaluateIraType : {
		subtitle: "Traditional or Roth IRA?",
		brief: "Individual Retirement Accounts (IRAs) provide tax incentives to encourage you to save for your future. Contributions to a Traditional IRA reduce your tax bill now. Contributing to a Roth account reduces your tax bill in the future. Use a Roth account if you expect your income to go up; otherwise, a Traditional IRA is better."
	},
	rolloverIra : {
		subtitle: "Rollover your Traditional IRA to a Roth IRA",
		brief: "The federal government restricts high earners from contributing to a Roth IRA, but there's a loophole! If your income is above the limit (congratulations!), you can create a \"Backdoor\" Roth IRA. Convert your Traditional IRA to a Roth IRA to avoid tax on growth. You will need to pay tax on growth your money made while in the traditional IRA and cannot claim a deduction for the Traditional IRA contributions."
	},
	backdoorRoth : {
		subtitle: "Use the \"Backdoor\"",
		brief: "The federal government restricts high earners from contributing to a Roth IRA, but there's a loophole! If your income is above the limit (congratulations!), you can create a \"Backdoor\" Roth IRA. First, put your money in a traditional IRA. Then, immediately convert your contribution to a Roth IRA to avoid tax on growth while in the Traditional IRA. You will not be able to claim a deduction for the contribution to the Traditional IRA."
	},
	maxRothIra : {
		subtitle: "Tap into tax-free growth",
		brief: "The money you invest in a Roth IRA grows tax-free. When you retire, you don't have to pay taxes on withdrawals. We suggest you contribute up to the IRS limit into a Roth IRA."
	},
	maxIra : {
		subtitle: "Max out that IRA",
		brief: "An Individual Retirement Account (IRA) provides tax incentives to encourage you to save for your future. Contributing the maximum amount to your IRA helps your money do more for you."
	},
	maxTraditionalIra : {
		subtitle: "Max out a Traditional IRA",
		brief: "An Individual Retirement Account (IRA) provides tax incentives to encourage you to save for your future. Using a Traditional IRA will reduce your tax bill today, making it easier to invest. Those savings will be able to grow unimpeded; you won't have to pay taxes until you withdraw your money in retirement."
	},
	evaluateEspp : {
		subtitle: "Grow with your employer",
		brief: "An Employee Stock Purchase Program (ESPP) allows employees to use a portion of their salary to purchase shares of the company at a discounted price. Does your employer offer an ESPP? If so, increase your income by contributing the maximum amount to the ESPP. To diversify, sell the shares immediately when you get them."
	},
	otherGoalSavings : {
		subtitle: "Prepare for expected expenses",
		brief: "Do you expect to have significant expenses in the next five years? Whether it's a car, house, college, or elder-care, you should start saving now if you haven't. For short-term savings, invest in something low-risk like a high yield savings account or bonds."
	},
	max401k : {
		subtitle: "Max your 401(K)",
		brief: "The tax advantage from investing in a 401(K) account is a significant accelerator for retirement savings. Contributing the maximum amount is a great way to get the most out of your money."
	},
	megaBackdoor : {
		subtitle: "Use the \"Mega Backdoor\"",
		brief: "In 2021 the 401(K) contribution limit is $58k. That limit includes the $19.5k individual contribution limit and your employer match. Use the \"Mega Backdoor\" method to reach the $58k limit. Not all 401(K) plans offer it. To use it, you'll need to be able to make after-tax 401(K) contributions and roll them over to a Roth IRA."
	},
	esa : {
		subtitle: "Saving for education",
		brief: "If you want to pay for education or training for yourself or someone else,  consider using a 529 Plan Education Savings Account (ESA). Growth in an ESA isn't taxed if it's withdrawn for eligible expenses, making it a great way to save for future education."
	},
	mortgagePayments : {
		subtitle: "Consider paying off your mortgage",
		brief: "Mortgages are one of the lowest cost loans available. Over a decade, the stock market generally provides higher returns than mortgage interest. Consider paying off your mortgage faster if you: <ul><li>are close to retirement,</li><li>have low risk tolerance, or</li> <li>value knowing that you fully own your home.</li></ul>"
	},
	taxableBrokerage : {
		subtitle: "Invest in a regular brokerage account",
		brief: "Have you already maxed out all of the relevant tax-advantaged accounts available to you? Consider investing in a regular brokerage account. "
	},
	taxHarvesting : {
		subtitle: "Evaluate tax loss harvesting",
		brief: "Short-term losses are most valuable when used to offset short-term gains, which are taxed as ordinary income. Conversely, short-term losses are least effective when used to offset long-term gains. Realized losses can offset up to $3000 of earned income per year. The remaining can be carried forward to future years."
	},
	lowInterestDebts : {
		subtitle: "Evaluate paying off low-interest debt",
		brief: "\"Low-interest\" debt is debt that is below the average rate-of-return for the stock market over time, which is about 7% adjusted for inflation. It's better to invest your money than pay off low-interest debt aggressively; however, there can be an emotional toll to debt. Evaluate if it is worthwhile to allocate some money to pay off low-interest debt early."
	},
	donorAdvisedFunds : {
		subtitle: "Efficient charity with donor-advised funds",
		brief: "You don't have to be wealthy to open a donor-advised fund (DAF). DAFs are an efficient donation vehicle because you can donate assets with unrealized gains. To get the most out of them, set aside assets that have grown substantially - the value of the assets is tax-deductible at the transfer time."
	},
	rebalancePortfolio : {
		subtitle: "Rebalancing your portfolio",
		brief: "Your assets should reflect your risk tolerance. Over time, investments will grow and shrink. Rebalancing your portfolio nudges it back to the initial asset ratios through buying and selling."
	}
}
for(const kudo in kudos){
	kudos[kudo].title = "Milestone accomplished";
}
for(const rec in recommendations){
	recommendations[rec].title = "Recommendation";
}

function buildResultCard(resultKey, resultsObj, options = {}){	
	if(resultsObj.hasOwnProperty(resultKey)){
		let result = resultsObj[resultKey];
		
		let element = `
		<section class="card" card-type="${options.hasOwnProperty("card-type") ? options["card-type"] : ""}">
			<header class="card__header">
				${resultsObj["icon"]}
				<div class="card__header-text-container">
				<h3 class="card__subtitle">${result["subtitle"]}</h3>
					<h4 class="card__title">${result["title"]}</h4>
				</div>
			</header>
			<p class="card__text">${result["brief"]}</p>
			${result.hasOwnProperty("learnmore") ? 
				`<a class="card__action button" href='${result["learnmore"]}>Learn more</a>` : ''
			}
		</section>`;
		return element;
	}
	return null;
}

class Results{
	constructor(){
		let searchParams = new URLSearchParams(window.location.search);
		let recList = searchParams.getAll("recommendations");
		let kudoList = searchParams.getAll("kudos");

		let parentElement = document.getElementById("results");

		
		if(recList.length > 0){
			this.insertSectionHeader("Next step", parentElement);
			
			const resultHTML = buildResultCard(recList.pop(), recommendations, {"card-type" : "warn"});
			if(null != resultHTML){
				this.insertResult(resultHTML, parentElement);
			} 
		}

		if(0 < kudoList.length){
			this.insertSectionHeader("Financial achievements", parentElement);
		}
		let resultBlob = ``;
		for(const result of kudoList){
			const resultHTML = buildResultCard(result, kudos, {"card-type" : "check"});
			if(null != resultHTML){
				resultBlob += resultHTML;	
				this.insertResult(resultHTML, parentElement);
			}
		}
		
		if(0 < recList.length){
			this.insertSectionHeader("Future steps", parentElement);
		}
		for(const result of recList){
			const resultHTML = buildResultCard(result, recommendations, {"card-type" : "warn"});
			if(null != resultHTML){
				this.insertResult(resultHTML, parentElement);
			}
		}
	}
	insertSectionHeader(header, parent){
		const element = `
		<h2 class="results__header">${header}</h2>
		`;
		parent.insertAdjacentHTML('beforeend', element);
	}
	insertResult(element, parent){
		parent.insertAdjacentHTML('beforeend', element);
	}
}



let _app = new Results();